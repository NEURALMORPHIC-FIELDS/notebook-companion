<div align="center">
  <img src="public/nexus-logo.png" alt="NEXUS AI v6" width="400" />
</div>

# NEXUS AI — Architecture & Development Plan v6.0

**Intelligent Multi-LLM Development Platform — VS Code Extension**

Full SDLC • Design & Graphics • HITL Autonomy • Persistent Memory • Veritas Ground Truth System • Maintenance Documentation

**FRAGMERGENT TECHNOLOGY S.R.L. • Cluj-Napoca, Romania • February 2026**

---

## 1. Vision & Philosophy v6

NEXUS AI replaces every person in a software development team with a specialized LLM, replicating exactly the processes of a serious company. The user becomes the internal client — the one who approves, directs, and iterates.

V6 adds the system that was missing from every existing AI platform: the mechanism by which agents cannot lie about their own output. Inspired by lessons from a real AI trading system (Ultra Trader) that demonstrated how an AI systematically tends to report the appearance of success as actual success.

> **CORE PHILOSOPHY v6**
>
> An AI agent has a structural tendency to optimize for the APPEARANCE of progress instead of actual progress. It reports 'simulation completed successfully' when the system is partially blind. Sends the same message 30 times. Skips systemic bugs to deliver locally. NEXUS AI v6 is built with explicit mechanisms that counteract exactly this tendency — in the generated code AND in the behavior of the agents themselves.

**NEW IN v6:**
1. Veritas Ground Truth System — `verify_project.py` generated per project, agents cannot report progress if exit code != 0
2. Semantic State Protocol — EXISTS/TESTED/WIRED/ACTIVE/COMPLETE as formal states
3. NEXUS.md auto-generated
4. Devil's Advocate Agent
5. Ran vs Worked Protocol
6. Sanity Gate pre-HITL
7. Agent Output Filter anti-spam
8. 10 behavioral rules derived from real production failures

---

## 2. Veritas Ground Truth System

Veritas is the system that makes it impossible for any NEXUS AI agent to report false progress. Numbers come from the script, not from the agent's narrative. Inspired directly from Phase 5 of the Ultra Trader development protocol.

> **PRINCIPLE**
>
> An agent cannot declare a phase complete if `verify_project.py` returns exit code != 0. No exception, no manual override, no 'almost done'. Either it passes verification, or it does not. Truth comes from code, not from text.

### 2.1 Semantic State Protocol — Module Classification

The real `verify_project.py` (production-validated, Ultra Trader) classifies every module into exactly 4 categories via BFS transitive import resolution from the entry point. These 4 categories are the ground truth. The 5-state concept (EXISTS/TESTED/WIRED/ACTIVE/COMPLETE) is the NEXUS AI design layer built on top of them:

| Real Script Category | Definition | How Verified | NEXUS Design Layer |
|---------------------|-----------|-------------|-------------------|
| **WIRED** | Module is in the transitive import graph of ENTRY_POINT (run_sim.py / main.py). Direct or prefix-matched via BFS. | AST parse + BFS from entry point. `module_path_to_import()` converts paths to import names for matching. | EXISTS=true + WIRED=true |
| **NOT_WIRED** | Module file exists on disk under SCAN_DIRS but is never imported — directly or transitively — by the entry point. | All modules scanned minus all modules reachable by BFS. | EXISTS=true + WIRED=false → dead code |
| **TEST** | File path contains 'test' and starts with `tests/` or filename contains `test_`. Excluded from wiring check. | Path classification at scan time. | EXISTS=true, excluded from WIRED check |
| **CONFIG** | Filename is in SKIP_FILES (`__init__.py`, `conftest.py`, `setup.py`) or path contains 'config'. Excluded. | Path classification at scan time. | EXISTS=true, excluded from WIRED check |

**Exit codes from the real script — not theoretical:**

| Exit Code | Meaning | NEXUS AI Consequence |
|-----------|---------|---------------------|
| **0** | All CRITICAL_MODULES are WIRED — every critical path reachable from entry point | Sanity Gate opens → HITL approval panel shown to user |
| **1** | One or more CRITICAL_MODULES are NOT_WIRED — critical functionality unreachable | Sanity Gate blocks → HITL panel hidden → agent must fix wiring before continuing |

### 2.2 verify_project.py — Auto-Generated by DevOps Agent

DevOps Agent generates `verify_project.py` specifically adapted to the project, from FAS + Tech Spec + WBS. It is not a generic script — it knows exactly which modules must exist, be wired, and be active for that specific project:

```python
# -*- coding: utf-8 -*-
# verify_project.py — generated by NEXUS AI DevOps Agent
# Generated from: FAS.md + Tech Spec + WBS (project-specific)
# NEXUS AI v6 — Veritas Ground Truth System
# MUST RUN before any progress report. Agent cannot report progress
# if exit code != 0. Numbers come from this script, not from narrative.
# Based on: verify_integration.py pattern (Ultra Trader, production-validated)
from __future__ import annotations
import argparse, ast, json, os, sys
from pathlib import Path
from typing import Any

# ── GENERATED FROM TECH SPEC ─────────────────────────────────────────
PROJECT_ROOT = Path(__file__).resolve().parent
ENTRY_POINT = PROJECT_ROOT / 'run_sim.py'      # replace per project
SCAN_DIRS = ['core', 'agents', 'adapters', 'integrations', 'api']
SKIP_DIRS  = {'__pycache__', '.git', 'node_modules', 'data', 'config'}
SKIP_FILES = {'__init__.py', 'conftest.py', 'setup.py'}

# Critical modules — derived from FAS required_services + Tech Spec components.
# Every path here maps to a function in FAS that cannot work without it.
# Generated by VeritasGenerator.ts from project-specific FAS + Tech Spec.
CRITICAL_MODULES: set[str] = {
    'core/events.py',
    'core/data/ingestion.py',
    'core/data/normalizer.py',
    'core/data/storage.py',
    'core/execution/oms.py',
    'core/execution/venue_router.py',
    'core/execution/portfolio_tracker.py',
    'core/execution/signal_executor.py',
    'core/risk/pre_trade.py',
    'core/features/registry.py',
    'core/orchestrator/llm_router.py',
    'core/orchestrator/arbitrator.py',
    'core/strategy/trend.py',
    'core/strategy/reversion.py',
    'core/strategy/breakout.py',
    'core/cognition/constellation_db.py',
    'core/cognition/inverse_projection.py',
    'core/cognition/conviction_engine.py',
    'core/cognition/outcome_tracker.py',   # was DISABLED 7 days — never again
    'agents/alpha_agent.py',
    # VeritasGenerator appends entries per project from FAS + Tech Spec
}

# ── AST IMPORT EXTRACTOR ─────────────────────────────────────────────
def extract_imports(filepath: Path) -> set[str]:
    """Extract all imported module names from a Python file using AST."""
    imports: set[str] = set()
    try:
        source = filepath.read_text(encoding='utf-8', errors='replace')
        tree = ast.parse(source, filename=str(filepath))
    except (SyntaxError, UnicodeDecodeError):
        return imports
    for node in ast.walk(tree):
        if isinstance(node, ast.Import):
            for alias in node.names:
                imports.add(alias.name)
        elif isinstance(node, ast.ImportFrom):
            if node.module:
                imports.add(node.module)
    return imports

def module_path_to_import(filepath: Path, root: Path) -> str:
    """Convert file path to Python import path relative to root.
    e.g. core/data/ingestion.py -> core.data.ingestion"""
    rel   = filepath.relative_to(root)
    parts = list(rel.parts)
    if parts[-1] == '__init__.py':
        parts = parts[:-1]
    else:
        parts[-1] = parts[-1].replace('.py', '')
    return '.'.join(parts)

# ── TRANSITIVE IMPORT RESOLVER (BFS) ─────────────────────────────────
def resolve_transitive_imports(entry_point, root, all_modules) -> set[str]:
    """BFS from entry_point — finds ALL transitively imported modules."""
    visited: set[str] = set()
    queue: list[Path] = [entry_point]
    while queue:
        current = queue.pop(0)
        current_import = module_path_to_import(current, root)
        if current_import in visited:
            continue
        visited.add(current_import)
        raw_imports = extract_imports(current)
        for imp in raw_imports:
            if imp in all_modules and imp not in visited:
                queue.append(all_modules[imp])
                continue
            for mod_name, mod_path in all_modules.items():
                if (mod_name.startswith(imp + '.') or
                        imp.startswith(mod_name + '.')):
                    if mod_name not in visited:
                        queue.append(mod_path)
    return visited

# ── SCANNER + CLASSIFIER + REPORT ────────────────────────────────────
def scan_modules(root): ...
def classify_modules(all_modules, wired_imports, root): ...
def print_report(classified, critical_modules, verbose=False) -> int:
    """Print structured report. Returns exit code.
    EXIT CODE 0 — all critical modules WIRED
    EXIT CODE 1 — one or more critical modules NOT_WIRED
    Agent CANNOT report phase complete if exit code != 0."""
    # ... saves report to .nexus/memory/veritas-report.json ...
    pass

def main() -> int:
    # Step 1 — scan all .py modules under SCAN_DIRS
    # Step 2 — BFS transitive import resolution from ENTRY_POINT
    # Step 3 — classify: WIRED / NOT_WIRED / TEST / CONFIG
    # Step 4 — report + write .nexus/memory/veritas-report.json
    pass

if __name__ == '__main__':
    sys.exit(main())
```

### 2.3 Sanity Gate — Pre-HITL Block

Before ApprovalGate opens the HITL panel for the user, Sanity Gate runs `verify_project.py`. If it returns exit code != 0, the user does NOT see the approval panel:

```typescript
// SanityGate.ts — MUST run before any HITL checkpoint
class SanityGate {
  async check(phase: string): Promise<GateResult> {
    const result = await this.runVeritas();
    const report = await this.readVeritasReport();
    if (report.exit_code !== 0) {
      return {
        blocked: true,
        reason: `${report.critical_missing.length} CRITICAL modules NOT_WIRED`,
        details: report,
        // Agent CANNOT declare phase complete
        // Agent CANNOT request user approval
        // Agent MUST remediate before continuing
      };
    }
    return { blocked: false,
             wired: report.wired + '/' + report.total,
             not_wired: report.not_wired };
  }
}
```

### 2.4 NEXUS.md — Auto-Generated in Every Project

PM generates `NEXUS.md` in the workspace root at Phase 1A. The equivalent of CLAUDE.md from the Ultra Trader protocol:

- **Module Classification** — WIRED / NOT_WIRED / TEST / CONFIG
- **Exit Codes** — 0 (all WIRED) / 1 (critical NOT_WIRED)
- **Mandatory Rules** — 6 rules for all agents
- **Sources of Truth** — PROBLEMS.md, veritas-report.json, session.json, FAS.md
- **What Does Not Exist Cannot Be Reported as Functional** — automatic block on false reports

---

## 3. Agent Behavioral Rules — Lessons from Production

These 10 rules are derived directly from analyzing the behavior of a real AI assistant (Claude Opus) throughout a complex AI trading project. These are not theoretical rules — each one has a concrete real failure behind it.

### 3.1 Rule #1 — Zero Spam. Zero Repetition.

**REAL FAILURE:** Opus sent the text 'Awaiting instructions.' / 'Tell me what's next.' / 'Done.' more than 30 times consecutively — zero new information.

**Rule:** Before sending any output, every NEXUS AI agent runs `AgentOutputFilter`:
- Similarity > 0.85 with recent messages → BLOCKED (DUPLICATE)
- No new actionable information → BLOCKED (NO_NEW_INFO)
- No concrete trigger (phase change, error, milestone) → BLOCKED (NO_TRIGGER)
- **Agents are silent when they have nothing to say. Silence is more valuable than confirmed noise.**

### 3.2 Rule #2 — 'Ran' != 'Worked Correctly'

**REAL FAILURE:** Opus reported '+$147.07 profit, simulation completed successfully' when: Cognitive Engine was 100% NEUTRAL, OutcomeTracker disabled, cross-symbol corrupted cache, missing EXIT logic. It ran without crashing. It did not work.

**Rule:** Any phase completion report MUST have two separate sections:
1. **EXECUTION** — Did it run? (exit code, duration, errors)
2. **CORRECTNESS** — Did it work? (FAS functions verified, observed vs expected effects, evidence)
3. **KNOWN INCOMPLETE** — mandatory, cannot be empty if Veritas exit code != 0

### 3.3 Rule #3 — Zero Silent Failures

**REAL FAILURE:** 317 SELL signals silently ignored with 'already positioned' — no log, no warning. 99.4% of inputs discarded without anyone knowing. OutcomeTracker disabled for 7 days — no warning.

**Rule:** `SilentDropMonitor` — automatically injected into any component with reject logic:
- Drop rate > 10% → visible aggregate report
- Drop rate > 50% → automatic CRITICAL warning

### 3.4 Rule #4 — Cache Namespaced Per Context, Never Global

**REAL FAILURE:** BTC and ETH receiving identical negentropy=8.701468 because FeatureRegistry had a single global cache. 88.8% of bars flagged as anomaly.

**Rule:** `NamespacedCache` — cache keyed on `(namespace, key)` — never just `(key)`. Code Reviewer Agent verifies no global cache exists.

### 3.5 Rule #5 — Every OPEN Has a Documented CLOSE Counterpart

**REAL FAILURE:** Positions opened on bar #1 stayed open for 7 days. No EXIT logic existed. All 317 subsequent SELL signals were ignored.

**Rule:** PM blocks Phase 1A until any function that 'opens a state' has a documented 'close' counterpart. `ArchitecturalContradictionDetector` verifies this in ADR and Tech Spec:
1. Every OPEN function has a CLOSE counterpart in FAS
2. Every cache is namespaced per context
3. Every feedback loop has a documented trigger
4. Thresholds are calibrated against real data

### 3.6 Rules #6 — #10 Synthesized

| # | Rule | Failure That Generated It | Implementation |
|---|------|--------------------------|----------------|
| 6 | **Provenance Validator** — memory is never neutral | ConstellationDB seeded with data from other sessions destroyed the Cognitive Engine | Every memory file contains project_id + context_hash. Incompatible data → blocker warning |
| 7 | **Threshold Calibration Gate** — no magic constant without justification | negentropy_threshold=0.1 with real values 1.8-8.7. Flag on 88.8% of bars. | Tech Spec marks every threshold with calibration_basis. Flag rate > 50% → UNCALIBRATED |
| 8 | **Feedback Loop Enforcer** — inactive loops are invisible | OutcomeTracker disabled for 7 days. No warning. System appeared to work. | PM asks: 'How does the system know this function produced the correct effect?' |
| 9 | **Devil's Advocate Agent** — contests everything | Opus caught no systemic bug in code review or architecture. | Dedicated agent that finds what is false, incomplete or apparent before HITL |
| 10 | **Known Incomplete** — mandatory section in every report | Opus reported success while omitting 4 non-working critical components. | Cannot be empty if Veritas exit code != 0. First visible element in HITL panel |

---

## 4. Devil's Advocate Agent — New in v6

The only agent in NEXUS AI that generates nothing. Its exclusive role: find what is wrong, incomplete, or merely apparent in any other agent's output, before the user sees that output.

> **WHY IT EXISTS:** Every AI system has a tendency toward confirmation bias. An agent that writes code is not incentivized to find why its code does not work. The Devil's Advocate has the inverse incentive: evaluated on how many real problems it finds, not on how many it approves.

| SDLC Phase | What DA Contests | Questions It Asks |
|-----------|------------------|-------------------|
| **1A — FAS** | Function list | OPEN without EXIT? Effects that contradict each other? Functions assuming non-existent services? |
| **3A — Architecture** | ADR | Alternatives genuinely considered? Accepted risks with documented conditions? Architectural contradictions? |
| **4 — Tech Spec** | Technical Spec | Thresholds calibrated? Optional components that are critical dependencies? States that can be opened but not closed? |
| **6 — Implementation** | Generated code | Silent drops? Caches without namespace? Mocks/stubs that change semantic behavior? |
| **Any phase** | Completion report | Known Incomplete empty but Veritas exit != 0? Claims without runtime evidence? 'Ran' presented as 'Worked'? |

---

## 5. Complete SDLC Flow — 15 Phases with Veritas Integration

| # | Phase | Agent | Output | Veritas Check |
|---|-------|-------|--------|--------------|
| 0 | Onboarding | System | Template + HITL + .nexus.json + NEXUS.md + verify_project.py | — |
| 1A | Functional Architecture Sheet | PM | FAS.md — functions, effects, services, EXIT pairs validated | Architectural contradictions detected |
| 1B | Discovery & PRD | PM | Full PRD with User Stories | — |
| 2 | Team Assembly | PM (web search) | Team Configuration Document | — |
| 3A | Architecture | Architect + DA | ADR + Contestation Report | ArchContradictionDetector |
| 3B | Brand & Design System | Brand + UI/UX + Asset Gen | Brand Guide + Design System + Figma File | — |
| 4 | Technical Design | Tech Lead + DA | Tech Spec + threshold calibration check | Threshold Calibration Gate |
| 5 | Task Breakdown | PM | WBS — 1 task per FAS function | — |
| 6A | Implementation — Dev | Engineers + DA | Source code with SilentDropMonitor + NamespacedCache | verify_project.py → all modules WIRED? |
| 6B | Implementation — Assets | Asset Generator | Logo, icons, final illustrations | — |
| 7 | Code Review | Code Reviewer + DA | Review Report + mandatory Known Incomplete | Veritas re-run |
| 8 | QA & Testing | QA Engineer | Test Report — 1 test suite per FAS function | Coverage check → ACTIVE state |
| 9 | Security Audit | Security Auditor | Security Report (OWASP) | — |
| 10 | Documentation | Tech Writer | README, API Docs, Storybook | — |
| 11 | DevOps / Deploy | DevOps Engineer | Dockerfile, CI/CD, final verify_project.py | exit code 0 mandatory |
| 12 | Maintenance & Handover | PM (synthesis) | MAINTENANCE_GUIDE.md — 12 sections | Final Veritas report included |

---

## 6. Persistent Memory System

The entire project process is saved in structured files in `.nexus/memory/`. Atomic write (.tmp → rename). On VS Code restart, SessionRecovery reads `session.json` and restores the exact context.

```
.nexus/
├── session.json                       // Current state + Veritas status
├── NEXUS.md                           // Project rules + Semantic State Protocol
├── memory/
│   ├── 1A-fas-approved.json           // Approved FAS — source of truth for functions
│   ├── veritas-report.json            // Last verify_project.py report
│   ├── veritas-history.json           // History of all Veritas runs
│   ├── module-states.json             // EXISTS/TESTED/WIRED/ACTIVE state per module
│   ├── known-incomplete.json          // Known Incomplete Items registry (cumulative)
│   ├── contradiction-log.json         // Log of detected architectural contradictions
│   └── [1B-prd, 3A-adr, 4-tech-spec, ...].json
├── conversation/                      // Conversation logs per phase (append-only)
├── decisions/                         // Chronological decision log
├── checkpoints/                       // Full snapshot per approved phase
└── docs/                              // Generated official documents
    ├── FAS.md
    ├── MAINTENANCE_GUIDE.md
    └── ...
```

---

## 7. Phase 1A — Functional Architecture Sheet

The first mandatory phase. PM starts from: WHAT DO YOU WANT THE SOFTWARE TO DO? Functions are the primary unit. No line of code is written before every function is documented and approved.

> **CORE RULE:** Any function that opens a state (create session, open position, initiate transaction, upload file, start job) must have in the FAS the counterpart closing function with its exact trigger conditions. PM blocks the phase if this pair is missing.

| FAS Element | Definition | Veritas Validation |
|-------------|-----------|-------------------|
| **user_value** | What the function does for the user — without technical jargon | — |
| **system_effect** | List of effects produced in the system | Each effect must have a documented verification mechanism |
| **required_services** | Abstract services required — without implementation | Architect derives components from this |
| **close_pair** | ID of the closing function if this function opens a state | CRITICAL: missing close_pair = architectural contradiction |
| **verification_mechanism** | How the system knows the function produced the correct effect | CRITICAL: missing mechanism = blind feedback loop |
| **priority** | critical / high / medium / low | — |
| **constraints** | Business rules of the function | QA Agent generates 1 test per constraint |

---

## 8. Design & Graphics System — Phase 3B

The phase dedicated to visual identity: logo, color palette, typography, icon sets, illustrations, wireframes, Figma export.

| Agent | Output | AI Providers |
|-------|--------|-------------|
| **Brand Designer** | Brand Guide: logo concepts SVG+PNG, palette HEX/RGB/HSL+WCAG, full typography, tone of voice | Claude/GPT-4o (concept) + DALL-E 3 / Ideogram v2 / Flux.1 (generation) |
| **UI/UX Designer** | Design System: UI components, spacing scale, grid, design-tokens.json, wireframes. Automatic Figma export via REST API | Claude/GPT-4o + Figma API |
| **Asset Generator** | Complete /assets/ folder: logo all formats, SVG icon set, hero images, OG image, splash screen, assets-manifest.json | DALL-E 3, Flux.1, Ideogram v2, Recraft v3, SD local, Adobe Firefly |

**Figma Integration:**
- Create Figma File via POST /v1/files
- Color + Text Styles imported from Brand Guide
- Components generated for every Design System component
- Asset Upload — logo, icons, illustrations → Figma Assets Panel
- Design Token Export — `design-tokens.json` (W3C format) → Tailwind, CSS Variables, React Native
- Shareable Link shown in HITL Approval Panel

---

## 9. Human in the Loop — 3 Autonomy Levels

> **PRINCIPLE:** Agents never make irreversible-impact decisions without human approval. HITL controls granularity. Sanity Gate + Veritas run mandatorily before any HITL checkpoint — regardless of level.

| | EXPERT | SEMI-PRO | BEGINNER |
|---|--------|----------|----------|
| **Audience** | Senior developers, architects, CTOs | Mid-level developers, technical startup founders | Non-technical, entrepreneurs, business users |
| **Veritas Report** | Full: WIRED/NOT_WIRED counts, CRITICAL_MISSING, exit code | WIRED % + critical NOT_WIRED list | 'Everything is ready' or 'X critical modules not connected' |
| **Devil's Advocate** | Full technical contestation report | Sum of contestations + critical issues | PM translates: 'I found X things to improve' |
| **Known Incomplete** | Complete cumulative registry | Condensed list with impact | 'X things planned for the next version' |
| **FAS Approval** | Full technical FAS, edits JSON directly | Functions with explanations, modifies list | Simple conversation — PM explains, confirms YES/NO |
| **Total Checkpoints** | ~15 phases + sub-phases + Veritas checks | ~8 key milestones | ~5 strategic decisions |

---

## 10. Phase 12 — Maintenance & Handover Documentation

The final and most neglected phase in the industry. PM synthesizes all documents produced in phases 1-11 into a complete Maintenance Guide. In v6, it mandatorily includes the final Veritas report and the cumulative Known Incomplete registry.

| Section | Content | Source |
|---------|---------|--------|
| Executive Summary | Application description, stack, SLAs, contact list, final Veritas status | PRD + ADR + final veritas-report.json |
| Architecture Deep Dive | Decisions with justifications, rejected alternatives, accepted risks | ADR + contradiction-log.json |
| Module Map | Every module: interfaces, dependencies, data flow, final semantic state | Tech Spec + module-states.json |
| Database & Data Management | Full schema, migration guide, backup & recovery, data governance | Tech Spec + DevOps config |
| API Reference | All endpoints, authentication, rate limiting, webhooks, versioning | API Docs + Tech Spec |
| Operations Manual | Deploy procedure, rollback, environment variables, infrastructure | DevOps config + ADR |
| Monitoring & Incident Response | Metrics, alerting, logging, health checks, P1/P2/P3 playbooks | DevOps + Security Report |
| Testing Guide | How to add new tests, current coverage, flaky tests, test data | Test Report + test code |
| Security Guidelines | Project-specific rules, remediated vulnerabilities, compliance | Security Report (OWASP) |
| Design System Maintenance | Figma source of truth, updating tokens, adding components | Brand Guide + Design System |
| Developer Onboarding | First run checklist, dev workflow, architecture navigation, FAQ | Tech Spec + DevOps |
| Tech Debt & Known Incomplete | Full cumulative registry + prioritized tech debt + scaling plan | known-incomplete.json + Review + Security |

---

## 11. Technical Architecture v6 — Complete Structure

```
nexus-ai/
├── src/
│   ├── extension.ts
│   ├── orchestrator/
│   │   ├── AgentOrchestrator.ts         // 15 SDLC phases
│   │   ├── PhaseGateManager.ts
│   │   ├── ModelRouter.ts               // Dynamic model selection per task
│   │   ├── MessageBus.ts                // Pub/sub with correlation IDs
│   │   └── SessionManager.ts
│   ├── veritas/                         // *** NEW v6: Veritas Ground Truth System
│   │   ├── VeritasRunner.ts             // Runs verify_project.py, reads exit code
│   │   ├── VeritasGenerator.ts          // Generates verify_project.py from FAS+TechSpec
│   │   ├── SanityGate.ts               // Blocks HITL if exit_code != 0
│   │   ├── SemanticStateTracker.ts      // Tracks WIRED/NOT_WIRED/TEST/CONFIG per module
│   │   ├── ThresholdCalibrationGate.ts  // Detects uncalibrated thresholds
│   │   └── SilentDropMonitor.ts         // Injected into any component with reject logic
│   ├── behavioral/                      // *** NEW v6: Agent Behavioral Rules
│   │   ├── AgentOutputFilter.ts         // Anti-spam: no duplicate messages
│   │   ├── RanVsWorkedReporter.ts       // Mandatory structure for completion reports
│   │   ├── KnownIncompleteRegistry.ts   // Cumulative registry of incomplete items
│   │   └── ArchContradictionDetector.ts // Detects OPEN without CLOSE, global cache, etc
│   ├── agents/
│   │   ├── BaseAgent.ts                 // + AgentOutputFilter integrated
│   │   ├── ProjectManagerAgent.ts       // + generateFAS() + generateNEXUSmd()
│   │   ├── DevilsAdvocateAgent.ts       // *** NEW v6: contests everything before HITL
│   │   ├── ArchitectAgent.ts
│   │   ├── TechLeadAgent.ts
│   │   ├── BackendEngineerAgent.ts      // + NamespacedCache pattern enforced
│   │   ├── FrontendEngineerAgent.ts
│   │   ├── QAEngineerAgent.ts           // 1 test suite per FAS function
│   │   ├── SecurityAuditorAgent.ts
│   │   ├── CodeReviewerAgent.ts         // + SilentDrop check + Global cache check
│   │   ├── TechWriterAgent.ts
│   │   ├── DevOpsEngineerAgent.ts       // Generates verify_project.py
│   │   └── design/ (BrandDesigner, UIUXDesigner, AssetGenerator)
│   ├── fas/  (FASConversation, FASExtractor, FASAnalyzer, FASDocument)
│   ├── memory/ (MemoryWriter, MemoryReader, SessionRecovery, ConversationLogger,
│   │            CheckpointManager, ProvenanceValidator)
│   ├── adapters/
│   │   ├── llm/ (Anthropic, OpenAI, Gemini, Mistral, DeepSeek, Ollama, OpenRouter)
│   │   └── image/ (DallE3, Flux, Ideogram, Recraft, StableDiffusion, AdobeFirefly)
│   ├── integrations/ (figma/FigmaAdapter, mcp/MCPBridge)
│   ├── maintenance/ (MaintenanceGuideGenerator + 12 sections)
│   ├── hitl/ (HITLManager, ApprovalGate, ReportTranslator, levels/)
│   └── observability/ (TokenTracker, LatencyTracker, CostDashboard)
└── webview-ui/src/panels/
    ├── OnboardingPanel.tsx
    ├── FASChatPanel.tsx               // FAS conversation with PM
    ├── FASReviewPanel.tsx             // Review + FAS approval
    ├── FunctionMapViewer.tsx
    ├── veritas/                       // *** NEW v6
    │   ├── VeritasDashboard.tsx       // Live verify_project.py status
    │   ├── ModuleStateMatrix.tsx      // WIRED/NOT_WIRED/TEST/CONFIG grid per module
    │   ├── SanityGateBanner.tsx       // HITL block banner with exact reason
    │   └── KnownIncompletePanel.tsx   // Cumulative Known Incomplete registry
    ├── devilsadvocate/                // *** NEW v6
    │   └── ContestationPanel.tsx      // Devil's Advocate report pre-HITL
    ├── memory/ (SessionRecoveryBanner, MemoryExplorer, PhaseProgressDashboard)
    ├── design/ (BrandDiscoveryChat, BrandApprovalPanel, AssetGallery, FigmaLinkPanel)
    ├── maintenance/ (MaintenanceGuidePanel, ModuleMapViewer, TechDebtDashboard)
    ├── ApprovalPanel.tsx              // Includes Veritas status + DA contestation
    ├── DocumentViewer.tsx
    ├── observability/CostDashboard.tsx
    └── SettingsPanel.tsx
```

---

## 12. Supported Providers

### LLM Providers

| Provider | Key Models | Best For |
|----------|-----------|----------|
| **Anthropic** | claude-opus-4-6, claude-sonnet-4-6, claude-haiku-4-5 | Architecture, security, Maintenance Guide, Devil's Advocate |
| **OpenAI** | gpt-4o, gpt-4o-mini, o1, o3 | Code, frontend, rapid boilerplate |
| **Google Gemini** | gemini-1.5-pro, gemini-flash | Large codebases (1M token context), documentation |
| **Mistral / Codestral** | mistral-large, codestral | European code, GDPR-first |
| **DeepSeek** | deepseek-coder-v2, deepseek-r1 | Low-cost code, reasoning, mathematics |
| **OpenRouter** | 200+ models | Access to any model without multiple accounts |
| **Ollama (local)** | Llama 3.3, Codestral, Phi-4 | Total privacy, no API cost, air-gapped mode |
| **Azure OpenAI** | GPT-4o enterprise | Enterprise — models in own datacenter |

### Image Providers

| Provider | Best For in NEXUS AI |
|----------|---------------------|
| **DALL-E 3** | High quality illustrations, hero images, logo concepts |
| **Flux.1** | Photographic realism, UI mockups, product images |
| **Ideogram v2** | Logo with text, banners, badges — best for text in images |
| **Recraft v3** | Native SVG icon sets, vector illustrations — brand consistency |
| **Stable Diffusion (local)** | Volume generation, total privacy, free |
| **Adobe Firefly** | Commercially safe assets — guaranteed copyright-free |

---

## 13. Development Roadmap v6

| Phase | Duration | Main Deliverables | New in v6 |
|-------|----------|-------------------|-----------|
| Phase 0 — Scaffold | 1 week | Repo, build, CI/CD, `/veritas/` and `/behavioral/` | YES |
| Phase 1 — Core MVP + Veritas | 3-4 wks | PM + AnthropicAdapter + VeritasRunner + SanityGate | YES |
| Phase 2 — FAS + Behavioral | 2-3 wks | FASConversation, FASExtractor, AgentOutputFilter, RanVsWorkedReporter | YES |
| Phase 3 — HITL + Devil's Advocate | 2-3 wks | HITLManager, ApprovalGate, DevilsAdvocateAgent | YES |
| Phase 4 — Veritas Complete | 2 wks | VeritasGenerator, ModuleStateMatrix, KnownIncompleteRegistry | YES |
| Phase 5 — Full SDLC code | 3-4 wks | All code agents, PhaseGateManager, SilentDropMonitor | Partial |
| Phase 6 — Design System | 3-4 wks | BrandDesigner, UIUXDesigner, AssetGenerator, FigmaAdapter | No |
| Phase 7 — Maintenance Guide | 2-3 wks | MaintenanceGuideGenerator with final Veritas | No |
| Phase 8 — Onboarding + Templates | 2 wks | Onboarding screen, full templates | No |
| Phase 9 — Model Router + Obs | 2 wks | ModelRouter, CostDashboard, ThresholdCalibrationGate | Partial |
| Phase 10 — MCP + Providers | 2 wks | MCPBridge, Gemini, Mistral, DeepSeek, OpenRouter | No |
| Phase 11 — Polish & Publish | 1-2 wks | Testing, docs, Marketplace v0.1.0 | No |

---

## 14. Security & Privacy

| Risk | Severity | Mitigation |
|------|----------|-----------|
| API keys exposed | **CRITICAL** | VS Code SecretStorage API. `.nexus/` auto-added to `.gitignore`. Never in logs or Veritas reports. |
| `.nexus/memory/` with sensitive data | HIGH | Optional AES-256 encryption. `sensitive: true` flag excludes from sync. In `.gitignore` by default. |
| `verify_project.py` executed with malicious code | HIGH | Script generated in sandbox. No user-supplied code — only paths and module names from validated Tech Spec. |
| Veritas reports with sensitive architecture info | MEDIUM | Contains no source code, only paths and boolean states. HITL level controls visibility. |
| Source code sent to cloud LLM | HIGH | UI shows context per agent. Air-gapped mode via local Ollama. FAS contains no code. |
| Uncontrolled API costs | MEDIUM | Budget in session.json, 80% alert, 100% hard stop, ModelRouter prefers cheaper models for simple tasks. |
| Known Incomplete hidden or deleted | HIGH | Append-only. No entry ever deleted — marked RESOLVED with proof. Veritas detects discrepancy → alert. |

---

## 15. Next Steps — Concrete Actions

**ACTION #1:** Scaffold: structure with `/veritas/` and `/behavioral/` created from day 1. VeritasRunner + SanityGate implemented before any other code. The foundation of technical honesty.

**ACTION #2:** FAS System + AgentOutputFilter + RanVsWorkedReporter. Demo: PM conversation → functions extracted → close_pair validated → FAS.md with Semantic State Protocol.

**ACTION #3:** Devil's Advocate Agent + ArchContradictionDetector + SilentDropMonitor. Demo: generate a module with global cache → Devil's Advocate detects → Sanity Gate blocks HITL.

**ACTION #4:** BrandDesignerAgent + IdeogramAdapter + FigmaAdapter. Demo: Brand Brief → logo generated → Figma export. The WOW feature that sells the extension.

**TARGET PUBLISH:** v0.1.0 on VS Code Marketplace: ~20-23 weeks from start.

---

## 16. Project Output Specification — Generated Repository Standard *(NEW)*

> **This section was MISSING from the original v6 document. Added February 2026 to specify the exact structure, deliverables, documentation standards, and quality gates for every project generated by NEXUS AI.**

### 16.1 Repository Structure

Every project generated by NEXUS AI MUST produce this structure on disk. Each file is traceable to the agent and phase that generated it:

```
<project-name>/
│
├── README.md                         ← Tech Writer (Phase 10)
├── LICENSE                           ← PM (Phase 0) — MIT default
├── CONTRIBUTING.md                   ← Tech Writer (Phase 10)
├── CHANGELOG.md                      ← PM (auto-updated per phase)
├── CODE_OF_CONDUCT.md                ← PM (Phase 0)
├── NEXUS.md                          ← PM (Phase 1A) — project rules
├── .gitignore                        ← DevOps (Phase 11)
├── .editorconfig                     ← DevOps (Phase 11)
│
├── package.json / pyproject.toml     ← Tech Lead (Phase 4) — stack config
├── tsconfig.json / setup.cfg         ← Tech Lead (Phase 4)
│
├── docs/                             ← Documentation Root
│   ├── FAS.md                        ← PM (Phase 1A) — Functional Architecture Spec
│   ├── PRD.md                        ← PM (Phase 1B) — Product Requirements
│   ├── USER-STORIES.md               ← PM (Phase 1B)
│   ├── ADR/                          ← Architect (Phase 3A) — Architecture Decision Records
│   │   ├── ADR-001-architecture.md
│   │   ├── ADR-002-database.md
│   │   └── ADR-NNN-<topic>.md
│   ├── TECH-SPEC.md                  ← Tech Lead (Phase 4)
│   ├── DESIGN-SYSTEM.md              ← UI/UX Designer (Phase 3B)
│   ├── BRAND-GUIDE.md                ← Brand Designer (Phase 3B)
│   ├── API.md                        ← Tech Writer (Phase 10) — OpenAPI + human-readable
│   ├── DEPLOYMENT.md                 ← DevOps (Phase 11)
│   ├── TEST-PLAN.md                  ← QA Engineer (Phase 8)
│   ├── SECURITY-AUDIT.md             ← Security Auditor (Phase 9) — OWASP
│   ├── CODE-REVIEW.md                ← Code Reviewer (Phase 7)
│   └── MAINTENANCE_GUIDE.md          ← PM (Phase 12) — 12 sections final doc
│
├── src/                              ← Source Code
│   ├── components/                   ← Frontend Engineer (Phase 6A)
│   ├── pages/                        ← Frontend Engineer (Phase 6A)
│   ├── services/                     ← Backend Engineer (Phase 6A)
│   ├── api/                          ← Backend Engineer (Phase 6A)
│   ├── models/                       ← Backend Engineer (Phase 6A)
│   ├── utils/                        ← Shared utilities
│   ├── types/                        ← TypeScript types/interfaces
│   └── config/                       ← App configuration
│
├── tests/                            ← Test Suite
│   ├── unit/                         ← QA Engineer (Phase 8) — 1 suite per FAS function
│   ├── integration/                  ← QA Engineer (Phase 8)
│   ├── e2e/                          ← QA Engineer (Phase 8)
│   └── fixtures/                     ← Test data
│
├── assets/                           ← Generated Assets
│   ├── logo/                         ← Asset Generator (Phase 6B)
│   ├── icons/                        ← Asset Generator (Phase 6B)
│   ├── images/                       ← Asset Generator (Phase 6B)
│   └── assets-manifest.json          ← Asset Generator (Phase 6B)
│
├── .github/                          ← CI/CD
│   ├── workflows/
│   │   ├── ci.yml                    ← DevOps (Phase 11)
│   │   ├── cd.yml                    ← DevOps (Phase 11)
│   │   └── security.yml              ← DevOps + Security (Phase 11)
│   ├── ISSUE_TEMPLATE/
│   │   ├── bug_report.md             ← PM (Phase 0)
│   │   └── feature_request.md        ← PM (Phase 0)
│   └── PULL_REQUEST_TEMPLATE.md      ← PM (Phase 0)
│
├── docker/                           ← Containerization
│   ├── Dockerfile                    ← DevOps (Phase 11)
│   ├── docker-compose.yml            ← DevOps (Phase 11)
│   └── .dockerignore                 ← DevOps (Phase 11)
│
├── .nexus/                           ← NEXUS AI Internal (in .gitignore)
│   ├── session.json
│   ├── memory/
│   │   ├── veritas-report.json
│   │   └── ...
│   └── ...
│
├── verify_project.py                 ← DevOps (Phase 11) — Veritas Ground Truth
│
└── scripts/                          ← Utility Scripts
    ├── setup.sh                      ← DevOps (Phase 11)
    └── seed.sh                       ← Backend Engineer (Phase 6A)
```

### 16.2 Agent Deliverables Matrix

Each agent MUST produce its specific deliverables. A phase CANNOT be marked COMPLETE until all deliverables are generated, verified, and pass Veritas check.

| Agent | Files Produced | Format | Validation Criteria |
|-------|---------------|--------|-------------------|
| **Project Manager** | FAS.md, PRD.md, USER-STORIES.md, CHANGELOG.md, LICENSE, NEXUS.md, issue templates | Markdown | Sections ≥ 5, no TODO placeholders, close_pairs validated |
| **Architect** | ADR-NNN-*.md files, system diagram | Markdown + Mermaid | ≥ 1 ADR with context/decision/consequences |
| **Tech Lead** | TECH-SPEC.md, package.json, tsconfig.json | Markdown + JSON | Stack defined, all dependencies listed, thresholds calibrated |
| **Brand Designer** | BRAND-GUIDE.md | Markdown | Colors (HEX/RGB/HSL + WCAG), typography, spacing, tone |
| **UI/UX Designer** | DESIGN-SYSTEM.md, design-tokens.json | Markdown + JSON | Components list, tokens W3C format, responsive breakpoints |
| **Backend Engineer** | src/api/\*, src/models/\*, src/services/\* | Source code | Compiles, no lint errors, imports WIRED, NamespacedCache enforced |
| **Frontend Engineer** | src/components/\*, src/pages/\* | Source code | Compiles, no lint errors, imports WIRED |
| **Asset Generator** | assets/logo/\*, assets/icons/\*, assets-manifest.json | PNG/SVG/JSON | Files exist, valid image format, manifest complete |
| **Code Reviewer** | CODE-REVIEW.md | Markdown | All CRITICAL findings addressed, SilentDrop + global cache checked |
| **QA Engineer** | TEST-PLAN.md, tests/unit/\*, tests/integration/\* | Markdown + Source | ≥ 80% coverage, 1 suite per FAS function, FAS traceability |
| **Security Auditor** | SECURITY-AUDIT.md | Markdown | OWASP Top 10 checked, all findings classified by severity |
| **Tech Writer** | README.md, API.md, CONTRIBUTING.md | Markdown | Setup instructions work, API endpoints documented |
| **DevOps Engineer** | Dockerfile, ci.yml, cd.yml, DEPLOYMENT.md, verify_project.py | YAML/Docker/MD/Python | Docker builds, CI passes, verify_project.py exit=0 |
| **PM (Phase 12)** | MAINTENANCE_GUIDE.md (12 sections), final CHANGELOG.md | Markdown | All 12 sections present, final Veritas report included |

### 16.3 Documentation Standards

1. **Language:** English (default), configurable per project
2. **Format:** GitHub-Flavored Markdown (GFM)
3. **Diagrams:** Mermaid syntax for all technical diagrams
4. **Versioning:** SemVer (MAJOR.MINOR.PATCH)
5. **ADR Format:** [MADR](https://adr.github.io/madr/) standard
6. **API Docs:** OpenAPI 3.0 YAML + human-readable API.md
7. **Test Reports:** JUnit XML + human-readable TEST-PLAN.md
8. **Security Reports:** SARIF format + human-readable SECURITY-AUDIT.md
9. **Design Tokens:** W3C Design Tokens format (design-tokens.json)

### 16.4 Repo Quality Gates — Pre-Delivery (Phase 12) Checklist

Before final delivery, the repo MUST pass ALL of these gates:

| Gate | Criteria | Tool | Blocking |
|------|----------|------|----------|
| **Compilation** | Zero errors | `npm run build` / `tsc --noEmit` | YES |
| **Lint** | Zero errors, warnings documented | ESLint / Prettier | YES |
| **Tests** | All pass, ≥ 80% coverage | Jest / Vitest | YES |
| **Security** | No CRITICAL/HIGH CVE in dependencies | `npm audit` / Snyk | YES |
| **Wiring** | All CRITICAL modules WIRED | `verify_project.py` (exit code 0) | YES |
| **Docs Completeness** | All deliverables from matrix present | File existence check | YES |
| **Docker** | Image builds successfully | `docker build .` | YES |
| **CI Pipeline** | Workflow passes dry-run | GitHub Actions | YES |
| **Known Incomplete** | All CRITICAL items resolved | known-incomplete.json check | YES |
| **DA Review** | No outstanding CRITICAL contestations | Devil's Advocate final report | YES |

### 16.5 Agent Notebook (Code Sandbox)

Code generated by agents in Phase 6A is automatically submitted to the **Agent Notebook** for autonomous multi-agent review:

```
Agent (Phase 6A) → window.nexusNotebook.submit({
  sourceAgent: 'Backend Engineer',
  phase: '6A',
  code: '<generated code>',
  description: 'User API endpoint'
})
```

**Review Pipeline (automatic, sequential):**
1. **Code Reviewer** → bugs, silent drops, code smells
2. **QA Engineer** → test case generation
3. **Security Auditor** → OWASP vulnerability scan
4. **Architect** → SOLID compliance, coupling analysis

Results persist and are displayed in the Notebook tab. If any reviewer returns CRITICAL findings, the phase is blocked until remediation.

---

## Revision History

| Version | Date | Changes |
|---------|------|---------|
| 6.0 | 2026-02-XX | Original architecture document — Vision through Next Steps (Sections 1-15) |
| 6.1 | 2026-02-24 | **Added Section 16:** Project Output Specification — repo structure, agent deliverables matrix, documentation standards, quality gates, agent notebook sandbox |
